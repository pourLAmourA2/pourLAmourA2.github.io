<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Lecteur audio pour Réseau Contact</title>
</head>

<body>
  <h1>Lecteur audio pour Réseau Contact</h1>
  <div style="width:100%; margin-bottom:4px;">
    <input type="text" id="photoURL"
      value="Adresse d'une photo sur RC - Par ex.: http://image.reseaucontact.com/v1/dynamic_resize/id/..."
      style="color:#696969; font-style:italic; width:100%; max-width:892px;"
      onfocus="clearURL()" onblur="initURL()" onkeypress="if (event.keyCode == 13) loadRCphoto();">
  </div>

  <div style="float:left; width:100%; max-width:640px; margin-right:4px;">
    <input type="button" id="boLoad"
      value="Charger la photo"
      style="width:100%; height:32px; margin-bottom:4px;"
      onclick="loadRCphoto()">
    <div id="audioControls"
      style="background-color:#A2A2A2; width:100%; height:400px;">
    </div>
  </div>

  <div style="float:left; width:256px;">
    <img id="photoOnRC" alt="Veuillez entrer une adresse valide dans le champ ci-dessus"
      style="background-color:#ffbfff; width:256px; height:525px;"
      onload="parsePicture()"></img>
  </div>
</body>

<script>
function clearURL() {
  var photoURL = document.getElementById("photoURL");
  photoURL.onfocus = function(){ photoURL.select(); };
  photoURL.value = "";
  photoURL.style.fontStyle = "normal";
  photoURL.style.color = "#000000";
}

function initURL() {
  var photoURL = document.getElementById("photoURL");

  if (photoURL.value.length == 0) {
    photoURL.style.color = "#696969";
    photoURL.style.fontStyle = "italic";
    photoURL.value = "Adresse d'une photo sur RC - Par ex.: http://image.reseaucontact.com/v1/dynamic_resize/id/...";
    photoURL.onfocus = clearURL;
  }
}

function loadRCphoto() {
  var photoURL = document.getElementById("photoURL").value;
  var re = new RegExp("^http://image.reseaucontact.com/v1/dynamic_resize/id/");

  if (re.exec(photoURL)) {
    photoURL = photoURL.replace(/size=[0-9]+x[0-9]+/gi, "size=700x525");
    photoURL = photoURL.replace(/resize_bigger=[a-z]+/gi, "resize_bigger=false");
    photoURL = photoURL.replace(/quality=[0-9]+/gi, "quality=99");
    photoURL = photoURL.replace(/&clip=[0-9]+/gi, "");
    photoURL = photoURL.replace(/&clip_gravity=[a-z]+/gi, "");

    // document.getElementById("audioControls").innerHTML = photoURL;
    document.getElementById("photoOnRC").src = photoURL;
  }
}

function parsePicture() {
  var curImage = document.getElementById("photoOnRC");
  console.log(curImage.naturalWidth);
  console.log(curImage.naturalHeight);
}
</script>
</html>
